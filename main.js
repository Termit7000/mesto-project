(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var t,n="popup_opened";function r(e){e.classList.remove(n),e.removeEventListener("mousedown",i)}function o(e){e.classList.add(n),function(e){var t=new CustomEvent("popupOpened"),n=e.querySelector(".popup__form");null==n||n.dispatchEvent(t)}(e),e.addEventListener("mousedown",i)}function i(e){e.target===e.currentTarget&&r(e.target)}document.addEventListener("keydown",(function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&r(t)}})),(t=document.querySelectorAll(".popup"),function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).forEach((function(e){var t=e.querySelector(".popup__button_event_close");t&&t.addEventListener("click",(function(){return r(e)}))}));var u=document.querySelector(".img-popup"),c=u.querySelector(".image-modal__body"),a=u.querySelector(".image-modal__caption");function l(e){e.setAttribute("disabled",!0),e.initValue=e.textContent,e.textContent="Сохранение..."}function s(e){e.removeAttribute("disabled"),e.textContent=e.initValue}function d(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))}var p=document.querySelector(".profile-popup"),v=p.querySelector(".popup__button_event_submit"),f=p.querySelector(".popup__form"),m=f.querySelector(".popup__input_name"),_=f.querySelector(".popup__input_description"),y=document.querySelector(".avatar-popup"),b=y.querySelector(".avatar-popup__link"),S=y.querySelector(".popup__button_event_submit"),h=document.querySelector(".profile__text"),g=document.querySelector(".profile__title"),q=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__avatar"),E=L.src;function C(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E;g.textContent=e,h.textContent=t,L.src=n,E=n}f.addEventListener("submit",(function(e){e.preventDefault(),l(v),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sivanov",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Описание",n="/users/me",r=JSON.stringify({name:e,about:t});return j({url_service:n,method:"PATCH",body:r})}(m.value,_.value).then((function(){return d(1500)})).finally((function(){C(m.value,_.value),s(v),r(p)}))})),q.addEventListener("click",(function(){m.value=g.textContent,_.value=h.textContent,o(p)})),L.addEventListener("click",(function(e){b.value=E,o(y)})),y.addEventListener("submit",(function(e){e.preventDefault(),l(S),function(e){try{new URL(e)}catch(e){return Promise.reject("Переданный адрес не является URL")}return j({url_service:"/users/me/avatar",method:"PATCH",body:JSON.stringify({avatar:e})})}(b.value).then((function(){return d(1500)})).finally((function(){E=b.value,L.src=b.value,s(v),r(y)}))}));var k="https://nomoreparties.co/v1/".concat("plus-cohort-5"),A="";function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return Promise.reject("Невозможно лайкнуть карточку: ID пуст");var t="/cards/likes/".concat(e);return j({url_service:t,method:"PUT"}).then((function(e){return w(e)}))}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return Promise.reject("Невозможно снять лайк с карточки: ID пуст");var t="/cards/likes/".concat(e);return j({url_service:t,method:"DELETE"}).then((function(e){return w(e)}))}function j(e){var t=e.url_service,n=e.method,r=void 0===n?"GET":n,o=e.body,i=void 0===o?"":o,u={method:r,headers:{authorization:"2da09b68-77d7-4eeb-bec1-377a2129dd59","Content-Type":"application/json"}};return i&&(u.body=i),fetch("".concat(k).concat(t),u).then((function(e){return e.ok?e.json():Promise.reject("Не удалось выполнить запрос к серверу ".concat(e.statusText))})).catch((function(e){return console.log(e)}))}function w(e){return{cardId:e._id,cardLink:e.link,name:e.name,countLikes:e.likes.length,isMine:e.owner.name===A,liked:Boolean(e.likes.find((function(e){return e.name===A})))}}var T="card__like-button_active",B=".card__count-likes",D=document.querySelector(".profile__add-button"),O=document.querySelector(".card-popup"),P=O.querySelector(".popup__button_event_submit"),M=O.querySelector(".popup__form"),U=M.querySelector(".popup__input_img-name"),N=M.querySelector(".popup__input_img-link"),J=document.querySelector(".elements"),H=document.querySelector(".templates").content.querySelector(".elements__list-item"),R=document.querySelector(".confirmation-popup"),V=R.querySelector(".confirmation-popup__form");function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cardId,n=void 0===t?"":t,r=e.cardLink,o=void 0===r?"":r,i=e.name,u=void 0===i?"":i,c=e.countLikes,a=void 0===c?0:c,l=e.isMine,s=void 0!==l&&l,d=e.liked,p=void 0!==d&&d,v=H.cloneNode(!0);return v.cardID=n,K(v,u,o),G(v,n,p),W(v,a),F(v,n,s),v}function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J;t.prepend(e)}function G(e,t,n){var r=e.querySelector(".card__like-button");r.addEventListener("click",(function(){!function(e,t,n){(!function(e){return e.classList.contains(T)}(t)?I:x)(n).then((function(n){Q(t,n.liked),W(e,n.countLikes)}))}(e,r,t)})),Q(r,n)}function F(e,t,n){var r=e.querySelector(".card__trash-button");n||r.classList.add("card__trash-button_inactive"),r.addEventListener("click",(function(){V.cardId=t,V.currentCard=e,o(R)}))}function K(e,t,n){var r=e.querySelector(".card__img");r.src=n,r.alt=t,e.querySelector(".card__text").textContent=t,e.querySelector(".card__popup-button").addEventListener("click",(function(){return e=n,r=t,c.src=e,c.alt=r,a.textContent=r,void o(u);var e,r}))}function Q(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?e.classList.add(T):e.classList.remove(T)}function W(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.querySelector(B).textContent=t}function X(e){return function(e){if(Array.isArray(e))return Y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Y(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}D.addEventListener("click",(function(){U.value="",N.value="",o(O)})),M.addEventListener("submit",(function(e){e.preventDefault(),l(P),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="/cards",r=JSON.stringify({name:e,link:t});return j({url_service:n,method:"POST",body:r}).then((function(e){return w(e)}))}(U.value,N.value).then((function(e){return z($(e))})).then((function(){return d(1500)})).finally((function(){s(P),r(O)}))})),R.addEventListener("submit",(function(e){if(e.preventDefault(),e.target.cardId){var t=e.target.currentCard;(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e?j({url_service:"/cards/".concat(e),method:"DELETE"}):Promise.reject("Невозможно удалить карточку: ID пуст")})(e.target.cardId).then((function(){t.remove()})).finally((function(){return r(R)}))}else r(R)}));var Z={formSelector:"",inputSelector:"",submitButtonSelector:"",inactiveButtonClass:"",inputErrorClass:"",errorClass:""},ee=function(e){var t=X(e.querySelectorAll(Z.inputSelector)),n=e.querySelector(Z.submitButtonSelector);ie(t,n),t.forEach((function(e){e.addEventListener("input",(function(){te(e),ie(t,n)}))})),e.addEventListener("popupOpened",(function(){return ie(t,n)}))},te=function(e){e.validity.valid?re(e):ne(e,e.validationMessage)},ne=function(e,t){var n=oe(e);e.classList.add(Z.inputErrorClass),n.classList.add(Z.errorClass),n.textContent=t},re=function(e){var t=oe(e);e.classList.remove(Z.inputErrorClass),t.classList.remove(Z.errorClass)},oe=function(e){var t=e.errorLabel;return t||(t=e.closest(".popup__input-label").querySelector("#".concat(e.id,"-error")),e.errorLabel=t),t},ie=function(e,t){!function(e){return e.every((function(e){return e.validity.valid}))}(e)?(t.classList.add(Z.inactiveButtonClass),t.setAttribute("disabled",!0)):(t.classList.remove(Z.inactiveButtonClass),t.removeAttribute("disabled"))};j({url_service:"/users/me"}).then((function(e){var t=e.name,n=e.about,r=e.avatar;A=t,C(t,n,r)})),j({url_service:"/cards"}).then((function(e){e.map((function(e){return w(e)})).forEach((function(e){z($(e))}))})),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.formSelector,n=void 0===t?".popup__form":t,r=e.inputSelector,o=void 0===r?".popup__input":r,i=e.submitButtonSelector,u=void 0===i?".popup__button_event_submit":i,c=e.inactiveButtonClass,a=void 0===c?"popup__button_inactive":c,l=e.inputErrorClass,s=void 0===l?"popup__input_type_error":l,d=e.errorClass,p=void 0===d?"popup__input-error_active":d;Z.formSelector=n,Z.inputSelector=o,Z.submitButtonSelector=u,Z.inactiveButtonClass=a,Z.inputErrorClass=s,Z.errorClass=p,X(document.querySelectorAll(n)).forEach((function(e){return ee(e)}))}()})();