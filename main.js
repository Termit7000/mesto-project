(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{x:()=>Q});var e="https://nomoreparties.co/v1/".concat("plus-cohort-5"),n="card__like-button_active",r="popup_opened";function o(t){t.classList.remove(r),document.removeEventListener("keydown",u)}function i(t){t.classList.add(r),document.addEventListener("keydown",u)}function u(t){"Escape"===t.key&&o(document.querySelector(".popup_opened"))}document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("click",(function(e){e.target.classList.contains(r)&&o(t),e.target.classList.contains("popup__close")&&o(t)}))}));var c=document.querySelector(".img-popup"),a=c.querySelector(".image-modal__body"),l=c.querySelector(".image-modal__caption");function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e="/cards/likes/".concat(t);return p({url_service:e,method:"PUT"})}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e="/cards/likes/".concat(t);return p({url_service:e,method:"DELETE"})}function p(t){var n=t.url_service,r=t.method,o=void 0===r?"GET":r,i=t.body,u=void 0===i?"":i,c={method:o,headers:{authorization:"2da09b68-77d7-4eeb-bec1-377a2129dd59","Content-Type":"application/json"}};return u&&(c.body=u),fetch("".concat(e).concat(n),c).then((function(t){return t.ok?t.json():Promise.reject("Не удалось выполнить запрос к серверу ".concat(t.statusText))}))}function v(t){t.setAttribute("disabled",!0),t.initValue=t.textContent,t.textContent="Сохранение..."}function f(t){t.removeAttribute("disabled"),t.textContent=t.initValue}function m(t){var e=new CustomEvent("formOpened");t.dispatchEvent(e)}var _=document.querySelector(".profile__add-button"),y=document.querySelector(".card-popup"),b=y.querySelector(".popup__button_event_submit"),h=y.querySelector(".popup__form"),S=h.querySelector(".popup__input_img-name"),g=h.querySelector(".popup__input_img-link"),q=document.querySelector(".elements"),L=document.querySelector(".templates").content.querySelector(".elements__list-item"),E=document.querySelector(".confirmation-popup"),k=E.querySelector(".confirmation-popup__form");function C(t){t.forEach((function(t){!function(t){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:q).prepend(t)}(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.cardId,n=void 0===e?"":e,r=t.cardLink,o=void 0===r?"":r,i=t.name,u=void 0===i?"":i,c=t.countLikes,a=void 0===c?0:c,l=t.isMine,s=void 0!==l&&l,d=t.liked,p=void 0!==d&&d,v=L.cloneNode(!0);return v.cardID=n,O(v,u,o),A(v,n,p),I(v,a),x(v,n,s),v}(j(t)))}))}function A(t,e,r){var o=t.querySelector(".card__like-button");o.addEventListener("click",(function(){!function(t,e,r){(!function(t){return t.classList.contains(n)}(e)?s:d)(r).then((function(n){var r=j(n);w(e,r.liked),I(t,r.countLikes)})).catch((function(t){return console.log(t)}))}(t,o,e)})),w(o,r)}function x(t,e,n){var r=t.querySelector(".card__trash-button");n||r.classList.add("card__trash-button_inactive"),r.addEventListener("click",(function(){k.cardId=e,k.currentCard=t,i(E)}))}function O(t,e,n){var r=t.querySelector(".card__img");r.src=n,r.alt=e,t.querySelector(".card__text").textContent=e,t.querySelector(".card__popup-button").addEventListener("click",(function(){return t=n,r=e,a.src=t,a.alt=r,l.textContent=r,void i(c);var t,r}))}function w(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?t.classList.add(n):t.classList.remove(n)}function I(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.querySelector(".card__count-likes").textContent=e}function j(t){return{cardId:t._id,cardLink:t.link,name:t.name,countLikes:t.likes.length,isMine:t.owner._id===Q,liked:Boolean(t.likes.find((function(t){return t._id===Q})))}}_.addEventListener("click",(function(){m(h),i(y)})),h.addEventListener("submit",(function(t){t.preventDefault(),v(b),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="/cards",r=JSON.stringify({name:t,link:e});return p({url_service:n,method:"POST",body:r})}(S.value,g.value).then((function(t){C([t]),o(y)})).catch((function(t){return console.log(t)})).finally((function(){S.value="",g.value="",f(b)}))})),E.addEventListener("submit",(function(t){if(t.preventDefault(),t.target.cardId){var e=t.target.currentCard;(function(){return p({url_service:"/cards/".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""),method:"DELETE"})})(t.target.cardId).then((function(){e.remove(),o(E)})).catch((function(t){return console.log(t)}))}else o(E)}));var T=document.querySelector(".profile-popup"),P=T.querySelector(".popup__button_event_submit"),D=T.querySelector(".popup__form"),B=D.querySelector(".popup__input_name"),M=D.querySelector(".popup__input_description"),N=document.querySelector(".avatar-popup"),J=N.querySelector(".popup__form"),U=N.querySelector(".avatar-popup__link"),H=N.querySelector(".popup__button_event_submit"),V=document.querySelector(".profile__text"),$=document.querySelector(".profile__title"),z=document.querySelector(".profile__edit-button"),G=document.querySelector(".profile__avatar");function F(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";$.textContent=t,V.textContent=e,n&&(G.src=n)}function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}D.addEventListener("submit",(function(t){t.preventDefault(),v(P),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sivanov",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Описание",n="/users/me",r=JSON.stringify({name:t,about:e});return p({url_service:n,method:"PATCH",body:r})}(B.value,M.value).then((function(){F(B.value,M.value),o(T)})).catch((function(t){return console.log(t)})).finally((function(){return f(P)}))})),z.addEventListener("click",(function(){B.value=$.textContent,M.value=V.textContent,i(T),m(D)})),G.addEventListener("click",(function(t){m(J),i(N)})),N.addEventListener("submit",(function(t){var e;t.preventDefault(),v(H),(e=U.value,p({url_service:"/users/me/avatar",method:"PATCH",body:JSON.stringify({avatar:e})})).then((function(t){G.src=t.avatar,o(N)})).catch((function(t){return console.log(t)})).finally((function(){return f(H)}))}));var Q,R=function(t,e){var n,r=function(t){if(Array.isArray(t))return K(t)}(n=t.querySelectorAll(e.inputSelector))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return K(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),o=t.querySelector(e.submitButtonSelector);tt(r,o,e),r.forEach((function(n){n.addEventListener("input",(function(){W(t,n,e),tt(r,o,e)}))})),t.addEventListener("formOpened",(function(){r.forEach((function(n){return W(t,n,e)})),tt(r,o,e)}))},W=function(t,e,n){e.validity.valid?Y(t,e,n):X(t,e,e.validationMessage,n)},X=function(t,e,n,r){var o=Z(t,e);e.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n},Y=function(t,e,n){var r=Z(t,e);e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass)},Z=function(t,e){var n=e.errorLabel;return n||(n=t.querySelector("#".concat(e.id,"-error")),e.errorLabel=n),n},tt=function(t,e,n){!function(t){return t.every((function(t){return t.validity.valid}))}(t)?(e.classList.add(n.inactiveButtonClass),e.setAttribute("disabled",!0)):(e.classList.remove(n.inactiveButtonClass),e.removeAttribute("disabled"))};function et(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}Promise.all([p({url_service:"/users/me"}),p({url_service:"/cards"})]).then((function(t){var e,n,r,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],u=!0,c=!1;try{for(n=n.call(t);!(u=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);u=!0);}catch(t){c=!0,o=t}finally{try{u||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return et(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],u=o[1],c=i._id,a=i.name,l=i.about,s=i.avatar;Q=c,F(a,l,s),C(u),r={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button_event_submit",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},document.querySelectorAll(r.formSelector).forEach((function(t){return R(t,r)}))})).catch((function(t){return console.log("Не удалось связаться с сервером ".concat(t))}))})();